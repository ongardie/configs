#!/bin/sh

set -e


if [ $# -ne 1 ]; then
  echo "Usage: install-vscodium VERSION"
  echo "See https://github.com/VSCodium/vscodium/releases"
  exit 1
fi

mkdir -p "$HOME/opt"
cd "$HOME/opt"

if [ -d "vscodium-$1" ]; then
  echo "vscodium $1 already installed in $HOME/opt/"
  exit 0
fi

mkdir -p "vscodium-$1"
cd "vscodium-$1"
touch .nobck

curl -L "https://github.com/VSCodium/vscodium/releases/download/$1/VSCodium-linux-x64-$1.tar.gz" | tar -xz
echo "Installed to ~/opt/vscodium-$1/codium"

cd ..
LATEST=$( (for f in vscodium-[0-9]*; do echo $f; done) | sort --version-sort | tail -n 1 )
ln -fns $LATEST vscodium-latest
